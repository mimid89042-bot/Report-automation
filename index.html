<!DOCTYPE html>
<html>
<head>
    <title>TWP Calculation</title>
    <style>
        body { font-family: Arial; margin: 40px; background-color: rgba(235,246,255,0.65);}
        label { display: inline-block; width: 250px;}
        input { margin-bottom: 10px; }
        .box { margin-top:20px; padding:20px; border:2px solid #fff; background:#edf3ffda;}
        .hidden { display:none; }
        .column { float:left; width:50%; }
        .row:after { content:""; display:table; clear:both; }
        .cases-container {display: flex;gap: 40px; margin-top: 20px;}
        .case-column {flex: 1;min-width: 220px;}
        .case-column label {display: inline-block;width: 120px;margin-bottom: 5px;}

    </style>
</head>
<body>

<h1>TWP Calculation</h1>

<form id="cohesive-inputs">
  <div class="box">
      <label>Subgrade Soil Type:</label>
      <select id="soilType" required>
          <option value="">-- Select Soil Type --</option>
          <option value="cohesive">Cohesive</option>
          <option value="granular">Granular</option>
      </select>
  </div>

<div id="cohesiveInputs" class="box hidden">
    <h3>Design values for ground properties</h3>
    <form id="cohesive-inputs">
    <div class="input-row">
        <label>Subgrade</label>
        <label>C<sub>u</sub> (kPa):</label>
        <input type="number" id="cu" step="0.1" required>
    </div>
    <div class = "input-row">
        <label>Working platform</label>
        <label>ϕ'<sub>p</sub> (°):</label>
        <input type="number" id="phi_p" step="0.1" value="40" required><br>
        <label></label>
        <label>γ<sub>p</sub> (kN/m³):</label>
        <input type="number" id="gamma" step="0.1" value="20" required><br>
    </div>

  <div class="cases-container">

    <div class="case-column">
        <h3>Case 1 loading inputs</h3>
        <label>q<sub>1k</sub> (kPa):</label><input type="number" id="q1k" required><br>
        <label>W<sub>1d</sub> (m):</label><input type="number" id="W1d" required><br>
        <label>L<sub>1d</sub> (m):</label><input type="number" id="L1d" required><br>
    </div>

    <div class="case-column">
        <h3>Case 2 loading inputs</h3>
        <label>q<sub>2k</sub> (kPa):</label><input type="number" id="q2k" required><br>
        <label>W<sub>2d</sub> (m):</label><input type="number" id="W2d" required><br>
        <label>L<sub>2d</sub> (m):</label><input type="number" id="L2d" required><br>
    </div>

</div>

    <button id="calculateBtn">Submit</button>
</form>
</div>

<!--outputs box-->
<div  class ="box hidden" id="results">
   <h3>Results</h3>
   <label>N<sub>c</sub> = (2+π) = 5.14</label><br>
   <label>N<sub>γp</sub> = <span id="N_gamma_p_display"></span></label>

   
   <h4>Case 1 results</h4>
   <p>s_c: <span id="sc_1"></span></p>
   <p>s_γ: <span id="sgamma_1"></span></p>
   <p>s_p: <span id="sp_1"></span></p>

   <h4>Case 2 results</h4>
   <p>s_c: <span id="sc_2"></span></p>
   <p>s_γ: <span id="sgamma_2"></span></p>
   <p>s_p: <span id="sp_2"></span></p>
</div>



<!-- Import JS as module -->
<script>
function s_c(W,L) { return 1 + 0.2 * (W/L); }
function s_gamma(W,L) { return 1 - 0.3 * (W/L); }
function s_p(W,L) { return 1 + (W/L); }
function N_gamma_p(phi_p) {
    const theta = phi_p * Math.PI / 180;
    const tanTheta = Math.tan(theta);
    const term1 = 2 * tanTheta;
    const term2 = 1 + Math.exp(Math.PI * tanTheta) * Math.pow(Math.tan(Math.PI / 4 + theta / 2), 2);
    return term1 * term2;}


document.getElementById("soilType").addEventListener("change", () => {
    const soil = document.getElementById("soilType").value;
    const cohesiveBox = document.getElementById("cohesiveInputs");
    
    if (soil === "cohesive") {
        cohesiveBox.classList.remove("hidden");
    } else {
        cohesiveBox.classList.add("hidden");
    }
});


// Modular update function
function updateCase(caseId, W, L) {
    document.getElementById(`sc_${caseId}`).textContent = s_c(W,L).toFixed(2);
    document.getElementById(`sgamma_${caseId}`).textContent = s_gamma(W,L).toFixed(2);
    document.getElementById(`sp_${caseId}`).textContent = s_p(W,L).toFixed(2);
}

document.getElementById("cohesive-inputs").addEventListener("submit", function(event){
    event.preventDefault();

    const form = event.target;

       // Check if all required fields are filled
    if (!form.checkValidity()) {
        form.reportValidity(); // shows browser tooltip
        return; // stop execution
    }

    const phi_p = parseFloat(document.getElementById("phi_p").value);

    // Gather inputs
    const inputValues = {
        cu: parseFloat(document.getElementById("cu").value),
        W1d: parseFloat(document.getElementById("W1d").value),
        L1d: parseFloat(document.getElementById("L1d").value),
        W2d: parseFloat(document.getElementById("W2d").value),
        L2d: parseFloat(document.getElementById("L2d").value)  
     };

    // Validation
    if (isNaN(inputValues.cu) || inputValues.cu <= 20 || inputValues.cu >= 80) {
        alert(inputValues.cu <= 20 ? "Subgrade too soft" : "Subgrade too stiff");
        return;
    }

    // Calculate N_gamma_p and display
    const N_gamma = N_gamma_p(phi_p);
    document.getElementById("N_gamma_p_display").textContent = N_gamma.toFixed(2);


    // Calculate modularly
    updateCase(1, inputValues.W1d, inputValues.L1d);
    updateCase(2, inputValues.W2d, inputValues.L2d);

    document.getElementById("results").classList.remove("hidden");


});
</script>

</body>
</html>
