<!DOCTYPE html>
<html lang = "en">
<head>
    <title>TWP Calculation</title>
    <meta charset= "utf-8">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; margin: 40px; background-color: rgba(235,246,255,0.65);}
        label { display: inline-block; width: 250px;}
        input { margin-bottom: 10px; }
        .box { margin-top:20px; padding:20px; border:2px solid #fff; background:#edf3ffda;}
        .hidden { display:none; }
        .cases-container {display: flex;gap: 40px; margin-top: 20px;}
        .case-column {flex: 1;min-width: 220px;}
        .case-column label {display: inline-block;width: 120px;margin-bottom: 5px;}
        .results-container {display: flex; gap: 40px;}
        .case-result {flex: 1;}
    </style>
</head>
<body>

<h1>TWP Calculation</h1>

<form id="cohesive-inputs">
    <div class="box">
        <label>Subgrade Soil Type:</label>
        <select id="soilType" required title = "subgrade soil type required">
            <option value="">-- Select Soil Type --</option>
            <option value="cohesive">Cohesive</option>
            <option value="granular">Granular</option>
        </select>
    </div>

    <div id="cohesiveInputs" class="box hidden">
        <h3>Design values for ground properties</h3>

        <div class="input-row">
            <label>Subgrade</label>
            <label>C<sub>u</sub> (kPa):
                <input type="number" id="cu" step="0.1" required>
            </label>
        </div>

        <div class="input-row" style="display: flex; gap: 20px; align-items: center;">
            <label>Working platform:</label>

            <label for="phi_p" style="display: flex; align-items: center; gap: 5px;">
                ϕ'<sub>p</sub> (°):
                <input type="number" id="phi_p" step="0.1" value="40" required>
            </label>

            <label for="gamma" style="display: flex; align-items: center; gap: 5px;">
                γ<sub>p</sub> (kN/m³):
                <input type="number" id="gamma" step="0.1" value="20" required>
            </label>
        </div>



        <div class="cases-container">
        <div class="case-column">
            <h3>Case 1 loading inputs</h3>
            <label>q<sub>1k</sub> (kPa):
                <input type="number" id="q1k" step="0.1" required>
            </label><br>

            <label>W<sub>1d</sub> (m):
                <input type="number" id="W1d" step="0.1" required>
            </label><br>

            <label>L<sub>1d</sub> (m):
                <input type="number" id="L1d" step="0.1" required>
            </label><br>
        </div>

        <div class="case-column">
            <h3>Case 2 loading inputs</h3>
            <label>q<sub>2k</sub> (kPa):
                <input type="number" id="q2k" step="0.1" required>
            </label><br>

            <label>W<sub>2d</sub> (m):
                <input type="number" id="W2d" step="0.1" required>
            </label><br>

            <label>L<sub>2d</sub> (m):
                <input type="number" id="L2d" step="0.1" required>
            </label><br>
        </div>
    </div>


        <button type="submit" id="calculateBtn">Submit</button>
    </div>
</form>

<!-- RESULTS BOX -->
<div class="box hidden" id="results">
   <h3>Results</h3>
   <label>N<sub>c</sub> = (2+π) = 5.14</label><br>
   <label>N<sub>γp</sub> = <span id="N_gamma_p_display"></span></label>

   <div class="results-container">
      <div class="case-result">
         <h3>Case 1 loading results</h3>
         <p>s<sub>c1</sub>: <span id="sc_1"></span></p>
         <p>s<sub>γ1</sub>: <span id="sgamma_1"></span></p>
         <p>s<sub>p1</sub>: <span id="sp_1"></span></p>
      </div>

      <div class="case-result">
         <h3>Case 2 loading results</h3>
         <p>s<sub>c2</sub>: <span id="sc_2"></span></p>
         <p>s<sub>γ2</sub>: <span id="sgamma_2"></span></p>
         <p>s<sub>p2</sub>: <span id="sp_2"></span></p>
      </div>
   </div>
</div>

<script>
// === Calculations ===
function s_c(W, L) { return 1 + 0.2 * (W / L); }
function s_gamma(W, L) { return 1 - 0.3 * (W / L); }
function s_p(W, L) { return 1 + (W / L); }

function N_gamma_p(phi_p) {
    const theta = phi_p * Math.PI / 180;
    const tanTheta = Math.tan(theta);
    return 2 * tanTheta * (1 + Math.exp(Math.PI * tanTheta) * Math.pow(Math.tan(Math.PI/4 + theta/2), 2));
}

// === UI Functions ===
function updateCase(caseId, W, L) {
    document.getElementById(`sc_${caseId}`).textContent = s_c(W,L).toFixed(2);
    document.getElementById(`sgamma_${caseId}`).textContent = s_gamma(W,L).toFixed(2);
    document.getElementById(`sp_${caseId}`).textContent = s_p(W,L).toFixed(2);
}

function showResults() {
    document.getElementById("results").classList.remove("hidden");
}

// Soil type toggle
document.getElementById("soilType").addEventListener("change", () => {
    const soil = document.getElementById("soilType").value;
    const cohesiveDiv = document.getElementById("cohesiveInputs");
    if (soil === "cohesive") {
        cohesiveDiv.classList.remove("hidden");
    } else {
        cohesiveDiv.classList.add("hidden");
    }
});

// Form submission
document.getElementById("cohesive-inputs").addEventListener("submit", function(event){
    event.preventDefault();
    const form = event.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }

    const phi_p = parseFloat(document.getElementById("phi_p").value);
    const inputValues = {
        cu: parseFloat(document.getElementById("cu").value),
        W1d: parseFloat(document.getElementById("W1d").value),
        L1d: parseFloat(document.getElementById("L1d").value),
        W2d: parseFloat(document.getElementById("W2d").value),
        L2d: parseFloat(document.getElementById("L2d").value)
    };

    if (inputValues.cu <= 20 || inputValues.cu >= 80) {
        alert(inputValues.cu <= 20 ? "Subgrade too soft" : "Subgrade too stiff");
        return;
    }

    const N_gamma = N_gamma_p(phi_p);
    document.getElementById("N_gamma_p_display").textContent = N_gamma.toFixed(2);

    updateCase(1, inputValues.W1d, inputValues.L1d);
    updateCase(2, inputValues.W2d, inputValues.L2d);

    showResults();
});
</script>

</body>
</html>
